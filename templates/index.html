<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AIBrief ‚Äì AI Summarizer</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>

  <div class="wrap">
    <div class="card">
      <h1>üìù AIBrief ‚Äì AI Note Summarizer</h1>
      <p class="muted">Paste text or upload a file. Choose backend and style. We do not store your text.</p>

      {% if error %}<div class="error">{{ error }}</div>{% endif %}

      <form method="POST" enctype="multipart/form-data">
        <div class="grid">
          <label class="block">
            <span class="lbl">Input Mode</span>
            <select name="text_source">
              <option value="paste">Paste Text</option>
              <option value="upload">Upload File (.txt, .md, .pdf, .docx)</option>
            </select>
          </label>
          <label class="block">
            <span class="lbl">Backend</span>
            <select name="backend">
              <option value="">(Use .env)</option>
              <option value="openai">OpenAI (GPT)</option>
              <option value="local">Local (Transformers)</option>
            </select>
          </label>
          <label class="block">
            <span class="lbl">Length</span>
            <select name="length">
              <option value="short">Short</option>
              <option value="medium">Medium</option>
              <option value="long">Long</option>
            </select>
          </label>

          <label class="block">
            <span class="lbl">Tone</span>
            <select name="tone">
              <option value="neutral">Neutral</option>
              <option value="concise">Concise</option>
              <option value="bullets">Bullet Points</option>
            </select>
          </label>
        </div>


        <textarea name="note" rows="12" placeholder="Paste your text here...">{{ input_preview or '' }}</textarea>
        <input type="file" name="file" />
        <div class="actions">
          <button>Summarize</button>
        </div>
      </form>


      {% if result %}
      <div class="result">
        
        <div class="flex">
          <h3>Summary</h3>
          <span class="pill">Backend: {{ result.backend }}</span>
          <span class="pill">Length: {{ result.length }}</span>
          <span class="pill">Tone: {{ result.tone }}</span>
          <span class="pill">Chunks: {{ result.stats.num_chunks }}</span>
          <span class="pill">Words: {{ result.stats.input_words }}</span>
          {% if result.from_cache %}<span class="pill good">Cached</span>{% endif %}
        </div>
        <pre id="summaryBox">{{ result.summary }}</pre>
        <form method="POST" action="/download">
          <input type="hidden" name="content" value="{{ result.summary }}" />
          <input type="hidden" name="filename" value="summary.txt" />
          <button type="submit" class="ghost">Download .txt</button>
          <button type="button" class="ghost" id="copyBtn">Copy</button>
        </form>

        {% if result.partials and result.partials|length > 1 %}
        <details>
          <summary>Show partial summaries (map step)</summary>
          <ol>
            {% for p in result.partials %}
              <li><pre>{{ p }}</pre></li>
            {% endfor %}
          </ol>
        </details>
        {% endif %}
      </div>
      {% endif %}

      <p class="note">Tip: Local backend downloads a model on first run; use OpenAI for best quality.</p>
    </div>
  </div>
<script>
  const btn = document.getElementById('copyBtn');
  if (btn) {
    btn.addEventListener('click', () => {
      const box = document.getElementById('summaryBox');
      navigator.clipboard.writeText(box.innerText).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(()=>btn.textContent='Copy', 1200);
      });
    });
  }
</script>
</body>
</html>
